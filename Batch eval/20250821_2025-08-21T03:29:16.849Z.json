{"createdAt":"2025-08-15T14:13:32.731Z","updatedAt":"2025-08-21T03:29:16.849Z","id":"XfWoECnQ8VnCPetc","name":"Batch eval","active":true,"isArchived":false,"nodes":[{"parameters":{"mode":"raw","jsonOutput":"{\n\t\"servering_host\": \"10.18.8.120\",\n\t\"servering_port\": 30080,\n\t\"concurrent\": 8,\n    \"cluster\": \"pek\",\n    \"meshy-latv\": 12,\n    \"meshy-latv-decoder\": 2,\n    \"meshy-meshkit-4x\": 2,\n    \"meshy-rf-to-tex\": 5,\n    \"meshy-control-net-plus\": 6,\n    \"meshy-texture-misc-gpu-2x\": 3,\n    \"meshy-holes-8x\": 2,\n    \"meshy-latv-decoder50\": 2,\n    \"meshy-latv50\": 10,\n    \"channel\": \"C09B5U3ETJ5\"\n}","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-680,-20],"id":"7e163028-b60e-4047-a355-7aa037a2af59","name":"Args"},{"parameters":{"authentication":"privateKey","command":"=source /home/runner/muse/batch_eval/.venv/bin/activate\npython3 img3d_batch.py -i /home/runner/batch-output/output_20250811_170752 --texture --serving-host {{ $('Args').item.json.servering_host }} --serving-port {{ $('Args').item.json.servering_port }} --concurrent-jobs {{ $('Args').item.json.concurrent }}","cwd":"/home/runner/muse/batch_eval"},"type":"n8n-nodes-base.ssh","typeVersion":1,"position":[1140,-20],"id":"e375cca1-6870-43a7-9a7d-722d31676f87","name":"texture5.1","credentials":{"sshPrivateKey":{"id":"hbQ0SL5G07trSaPf","name":"runner@n8n-runner"}}},{"parameters":{"authentication":"privateKey","command":"=#!/bin/bash\n\n# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ\nsource /home/runner/venv/bin/activate\n\n# è®¾ç½®å˜é‡\nCLUSTER=\"{{ $('Args').item.json.cluster }}\"\nAPP=\"meshy\"\nAPP_VERSION=\"{{ $('form-submission').item.json.app_version }}\"\nDEPLOY_SCRIPT=\"/home/runner/meshy-toolkit/k8s/deploy\"\n\n# æ£€æŸ¥å¿…è¦å‚æ•°\nif [[ -z \"$CLUSTER\" || -z \"$APP_VERSION\" ]]; then\n    echo \"é”™è¯¯: ç¼ºå°‘å¿…è¦å‚æ•°\"\n    echo \"CLUSTER: $CLUSTER\"\n    echo \"APP_VERSION: $APP_VERSION\"\n    exit 1\nfi\n\necho \"å¼€å§‹éƒ¨ç½²...\"\necho \"é›†ç¾¤: $CLUSTER\"\necho \"åº”ç”¨: $APP\"\necho \"ç‰ˆæœ¬: $APP_VERSION\"\n\n# ç¬¬ä¸€æ­¥ï¼šæ›´æ–°åº”ç”¨ç‰ˆæœ¬\necho \"æ­¥éª¤1: æ›´æ–°åº”ç”¨ç‰ˆæœ¬...\"\nif $DEPLOY_SCRIPT deploy --environ \"$CLUSTER\" --app \"$APP\" --app-version \"$APP_VERSION\"; then\n    echo \"âœ… ç‰ˆæœ¬æ›´æ–°æˆåŠŸ\"\nelse\n    echo \"âŒ ç‰ˆæœ¬æ›´æ–°å¤±è´¥\"\n    exit 1\nfi\n\n# ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œéƒ¨ç½²\necho \"æ­¥éª¤2: æ‰§è¡Œéƒ¨ç½²...\"\nif $DEPLOY_SCRIPT --environ \"$CLUSTER\" --app \"$APP\" deploy; then\n    echo \"âœ… éƒ¨ç½²æˆåŠŸå®Œæˆ\"\nelse\n    echo \"âŒ éƒ¨ç½²å¤±è´¥\"\n    exit 1\nfi\n\necho \"ğŸ‰ æ‰€æœ‰æ“ä½œå®Œæˆ\"","cwd":"/home/runner/meshy-toolkit"},"type":"n8n-nodes-base.ssh","typeVersion":1,"position":[-180,-20],"id":"7772c553-9c62-4f9d-bfb7-98d20e5da440","name":"deploy serving version","credentials":{"sshPrivateKey":{"id":"hbQ0SL5G07trSaPf","name":"runner@n8n-runner"}}},{"parameters":{"authentication":"privateKey","command":"=export KUBECONFIG=/home/runner/meshy-toolkit/k8s/environ/{{ $('Args').item.json.cluster }}/kubeconfig.yaml\n\n# è·å–æ‰€æœ‰ä½¿ç”¨ GPU çš„éƒ¨ç½²åç§°\ngpu_deployments=$(kubectl get deployments -n meshyd -o jsonpath='{range .items[?(@.spec.template.spec.containers[*].resources.requests.\"nvidia\\.com/gpu\")]}{.metadata.name}{\"\\n\"}{end}')\n\n# éå† GPU éƒ¨ç½²å¹¶ç¼©å®¹åˆ° 0\nfor deploy_name in $gpu_deployments; do\n    if [ ! -z \"$deploy_name\" ]; then\n        current_replicas=$(kubectl get deployment \"$deploy_name\" -n meshyd -o jsonpath='{.spec.replicas}')\n        echo \"Scaling down GPU deployment $deploy_name to 0 from $current_replicas\"\n        kubectl -n meshyd scale deployment \"$deploy_name\" --replicas=0\n    fi\ndone","cwd":"/home/runner/meshy-toolkit"},"type":"n8n-nodes-base.ssh","typeVersion":1,"position":[40,-20],"id":"2ab9953a-1a9f-4742-90db-72285bb88b0a","name":"draft scale down","credentials":{"sshPrivateKey":{"id":"hbQ0SL5G07trSaPf","name":"runner@n8n-runner"}}},{"parameters":{"authentication":"privateKey","command":"=export KUBECONFIG=/home/runner/meshy-toolkit/k8s/environ/{{ $('Args').item.json.cluster }}/kubeconfig.yaml\n\necho \"ğŸš€ æ‰©å®¹éƒ¨ç½² - ç‰ˆæœ¬: {{ $('form-submission').item.json.draft }},{{ $('form-submission').item.json.app_version }},{{ $('Args').item.json.cluster }}\"\n\nif [ {{ $('form-submission').item.json.draft }} == meshy-5.1 ]; then\n    kubectl -n meshyd scale deployment meshy-latv --replicas={{ $('Args').item.json['meshy-latv'] }}\n    kubectl -n meshyd scale deployment meshy-latv-decoder --replicas={{ $('Args').item.json['meshy-latv-decoder'] }}\n    kubectl -n meshyd scale deployment meshy-meshkit-4x --replicas={{ $('Args').item.json['meshy-meshkit-4x'] }}\n    echo \"âœ… meshy-5.1 éƒ¨ç½²æ‰©å®¹å®Œæˆ\"\nelif [ {{ $('form-submission').item.json.draft }} == meshy-5.0 ]; then\n    # æ·»åŠ ä½ çš„ meshy-5.0 é…ç½®\n    echo \"âœ… meshy-5.0 éƒ¨ç½²æ‰©å®¹å®Œæˆ\"\nelse\n    echo \"âš ï¸  æœªçŸ¥ç‰ˆæœ¬ï¼Œè·³è¿‡æ‰©å®¹\"\nfi","cwd":"/home/runner/meshy-toolkit"},"type":"n8n-nodes-base.ssh","typeVersion":1,"position":[220,-20],"id":"80bf9f23-a4e0-4b68-9f87-9211999d3de0","name":"draft scale up","credentials":{"sshPrivateKey":{"id":"hbQ0SL5G07trSaPf","name":"runner@n8n-runner"}}},{"parameters":{"authentication":"privateKey","command":"=source /home/runner/muse/batch_eval/.venv/bin/activate\npython3 img3d_batch.py -i /home/runner/muse/batch-output/assets/{{ $('form-submission').item.json.assets }} -o output --serving-host {{ $('Args').item.json.servering_host }} --serving-port {{ $('Args').item.json.servering_port }} --models {{ $('form-submission').item.json.draft }}","cwd":"/home/runner/muse/batch_eval/"},"type":"n8n-nodes-base.ssh","typeVersion":1,"position":[440,-20],"id":"e54098e6-bdac-4f1b-94fb-f56f1459345d","name":"draft","credentials":{"sshPrivateKey":{"id":"hbQ0SL5G07trSaPf","name":"runner@n8n-runner"}}},{"parameters":{"authentication":"privateKey","command":"=export KUBECONFIG=/home/runner/meshy-toolkit/k8s/environ/{{ $('Args').item.json.cluster }}/kubeconfig.yaml\n\n# è·å–æ‰€æœ‰ä½¿ç”¨ GPU çš„éƒ¨ç½²åç§°\ngpu_deployments=$(kubectl get deployments -n meshyd -o jsonpath='{range .items[?(@.spec.template.spec.containers[*].resources.requests.\"nvidia\\.com/gpu\")]}{.metadata.name}{\"\\n\"}{end}')\n\n# éå† GPU éƒ¨ç½²å¹¶ç¼©å®¹åˆ° 0\nfor deploy_name in $gpu_deployments; do\n    if [ ! -z \"$deploy_name\" ]; then\n        current_replicas=$(kubectl get deployment \"$deploy_name\" -n meshyd -o jsonpath='{.spec.replicas}')\n        echo \"Scaling down GPU deployment $deploy_name to 0 from $current_replicas\"\n        kubectl -n meshyd scale deployment \"$deploy_name\" --replicas=0\n    fi\ndone","cwd":"/home/runner/meshy-toolkit"},"type":"n8n-nodes-base.ssh","typeVersion":1,"position":[660,-20],"id":"846d9632-76d1-48cb-9358-68d70b816284","name":"texture scale down","credentials":{"sshPrivateKey":{"id":"hbQ0SL5G07trSaPf","name":"runner@n8n-runner"}}},{"parameters":{"authentication":"privateKey","command":"=echo \"ğŸš€ æ‰©å®¹éƒ¨ç½² - ç‰ˆæœ¬: {{ $('form-submission').item.json.draft }}{{ $('form-submission').item.json.app_version }}\"\n\nif [ {{ $('form-submission').item.json.draft }} == meshy-5.1 ]; then\n    echo \"æ‰©å®¹ meshy-rf-to-tex...\"\n    kubectl -n meshyd scale deployment meshy-rf-to-tex --replicas={{ $('Args').item.json['meshy-rf-to-tex'] }}\n    \n    echo \"æ‰©å®¹ meshy-control-net-plus...\"\n    kubectl -n meshyd scale deployment meshy-control-net-plus --replicas=\n{{ $('Args').item.json['meshy-control-net-plus'] }}    \n    echo \"æ‰©å®¹ meshy-texture-misc-gpu-2x...\"\n    kubectl -n meshyd scale deployment meshy-texture-misc-gpu-2x --replicas={{ $('Args').item.json['meshy-texture-misc-gpu-2x'] }}\n    \n    echo \"æ‰©å®¹ meshy-latv-decoder...\"\n    kubectl -n meshyd scale deployment meshy-latv-decoder --replicas={{ $('Args').item.json['meshy-latv-decoder50'] }}\n    \n    echo \"âœ… meshy-5.1 éƒ¨ç½²æ‰©å®¹å®Œæˆ\"\n    \nelif [ {{ $('form-submission').item.json.draft }} == meshy-5.0 ]; then\n    echo \"ğŸš€ æ‰©å®¹ meshy-5.0 éƒ¨ç½²...\"\n    echo \"âœ… meshy-5.0 éƒ¨ç½²æ‰©å®¹å®Œæˆ\"\n    \nelse\n    echo \"âš ï¸  æœªçŸ¥ç‰ˆæœ¬ï¼Œè·³è¿‡æ‰©å®¹\"\nfi","cwd":"/home/runner/meshy-toolkit"},"type":"n8n-nodes-base.ssh","typeVersion":1,"position":[880,-20],"id":"ea572e13-827e-4f8f-989a-1979f454a781","name":"texture scale up","credentials":{"sshPrivateKey":{"id":"hbQ0SL5G07trSaPf","name":"runner@n8n-runner"}}},{"parameters":{"select":"channel","channelId":{"__rl":true,"value":"={{ $('Args').item.json.channel }}","mode":"id"},"messageType":"attachment","attachments":[{"text":"=ï¿½ï¿½ è¯„æµ‹ä»»åŠ¡æ‰§è¡ŒæˆåŠŸï¼  ï¿½ï¿½ éƒ¨ç½²ä¿¡æ¯: â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” \nâ€¢ Serving ç‰ˆæœ¬: `{{ $('form-submission').item.json.app_version }}` \nâ€¢ åº”ç”¨åç§°: `meshy {{ $('form-submission').item.json.app_version }}` \nâ€¢ ç®—æ³•ç‰ˆæœ¬: `{{ $('form-submission').item.json.draft }}` \nâ€¢ ç›®æ ‡ç¯å¢ƒ: `{{ $('form-submission').item.json.draft }}`  \nâš™ï¸ è¯„æµ‹å‚æ•°: â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” \nâ€¢ å¹¶å‘ä»»åŠ¡æ•°: `{{ $('Args').item.json.concurrent }}` \nâ€¢ æ¨¡å‹ç±»å‹: ``  \nï¿½ï¿½ ç»“æœä¿¡æ¯: â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” \nâ€¢ è¾“å‡ºç›®å½•: `` \nâ€¢ ç»“æœåœ°å€: `{{ $('form-submission').item.json.draft }}:{{ $('Args').item.json.servering_port }}` \nâ€¢ ä»»åŠ¡çŠ¶æ€: âœ… æˆåŠŸå®Œæˆ \nâ° æ‰§è¡Œæ—¶é—´: {{ $now.format('YYYY-MM-DD HH:mm:ss') }}"}],"otherOptions":{"includeLinkToWorkflow":false}},"type":"n8n-nodes-base.slack","typeVersion":2.3,"position":[1380,-20],"id":"07e87ef5-1702-4d65-a264-019c000525da","name":"Send finish","webhookId":"2eb65517-dd80-4385-941a-52c1944b8718","credentials":{"slackApi":{"id":"iLK9eOc0lWWlxZZW","name":"Slack Meshy Bot"}}},{"parameters":{"formTitle":"batch_eval","formFields":{"values":[{"fieldLabel":"version","placeholder":"serving version","requiredField":true},{"fieldLabel":"draft","placeholder":"meshy-5 / meshy-5.1","requiredField":true},{"fieldLabel":"assets","placeholder":"PBR_Eval_20250722/Quick37_20250728","requiredField":true}]},"responseMode":"lastNode","options":{"path":"batch_eval"}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-920,-20],"id":"313a8c24-6faf-4135-884d-1042c847ddff","name":"form-submission","webhookId":"be745a25-c67c-46b2-8e36-9e5dbd76968f"}],"connections":{"Args":{"main":[[{"node":"deploy serving version","type":"main","index":0}]]},"deploy serving version":{"main":[[{"node":"draft scale down","type":"main","index":0}]]},"draft scale down":{"main":[[{"node":"draft scale up","type":"main","index":0}]]},"draft scale up":{"main":[[{"node":"draft","type":"main","index":0}]]},"draft":{"main":[[{"node":"texture scale down","type":"main","index":0}]]},"texture scale down":{"main":[[{"node":"texture scale up","type":"main","index":0}]]},"texture scale up":{"main":[[{"node":"texture5.1","type":"main","index":0}]]},"texture5.1":{"main":[[{"node":"Send finish","type":"main","index":0}]]},"form-submission":{"main":[[{"node":"Args","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"form-submission":[{"json":{"draft":"meshy-5.1","app_version":"304c7bf","assets":"PBR_Eval_20250722"}}]},"versionId":"a3a11028-b213-4711-8ca5-48b0d4b5e44f","triggerCount":1,"shared":[{"createdAt":"2025-08-15T14:13:32.731Z","updatedAt":"2025-08-15T14:13:32.731Z","role":"workflow:owner","workflowId":"XfWoECnQ8VnCPetc","projectId":"jA0J1Ydudz3t9Nad","project":{"createdAt":"2025-06-26T09:34:51.351Z","updatedAt":"2025-06-26T09:37:01.737Z","id":"jA0J1Ydudz3t9Nad","name":"Meshy AI <cloud-admins@meshy.ai>","type":"personal","icon":null,"description":null,"projectRelations":[{"createdAt":"2025-06-26T09:34:51.351Z","updatedAt":"2025-06-26T09:34:51.351Z","role":"project:personalOwner","userId":"35043bb3-1b78-4ddc-8eb1-4498c37e073f","projectId":"jA0J1Ydudz3t9Nad","user":{"createdAt":"2025-06-26T09:34:50.409Z","updatedAt":"2025-07-08T09:36:34.003Z","id":"35043bb3-1b78-4ddc-8eb1-4498c37e073f","email":"cloud-admins@meshy.ai","firstName":"Meshy","lastName":"AI","personalizationAnswers":null,"settings":{"userActivated":true,"easyAIWorkflowOnboarded":true,"firstSuccessfulWorkflowId":"5wCVdXpCNTB9yu66","userActivatedAt":1751967393973},"role":"global:owner","disabled":false,"mfaEnabled":false,"isPending":false}}]}}],"tags":[]}